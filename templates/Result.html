<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MediView - Drug Analysis Insight</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- AmCharts 4 (for 3D Pie) -->
  <script src="https://cdn.amcharts.com/lib/4/core.js"></script>
  <script src="https://cdn.amcharts.com/lib/4/charts.js"></script>
  <script src="https://cdn.amcharts.com/lib/4/themes/animated.js"></script>

  <!-- AmCharts 5 (for Pictorial Stacked) -->
  <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
  <script src="https://cdn.amcharts.com/lib/5/percent.js"></script>
  <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>

  <style>
    body {
      font-family: 'Inter', sans-serif;
    }

    .glass-panel {
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .chart-container {
      height: 350px;
      width: 100%;
    }

    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 10px;
    }
  </style>
</head>

<body class="bg-slate-50 min-h-screen text-slate-900 flex flex-col">
  <!-- Navbar -->
  <nav class="bg-white border-b border-slate-200 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
      <div class="flex items-center gap-3">
        <div class="bg-teal-600 p-2 rounded-xl">
          <i data-lucide="activity" class="text-white w-6 h-6"></i>
        </div>
        <span class="text-2xl font-bold tracking-tight">MediView</span>
      </div>
      <div class="flex gap-4">
        <a href="/home"
          class="px-5 py-2.5 text-slate-600 hover:text-teal-600 font-semibold transition-all flex items-center gap-2">
          <i data-lucide="layout-dashboard" class="w-5 h-5"></i> Back to Dashboard
        </a>
      </div>
    </div>
  </nav>

  <main class="flex-grow p-6 lg:p-10 max-w-7xl mx-auto w-full space-y-8">
    <!-- Result Header -->
    <div
      class="bg-white p-8 rounded-[2.5rem] shadow-xl border border-slate-100 flex flex-col md:flex-row justify-between items-center gap-6">
      <div class="space-y-2 text-center md:text-left">
        <h4 class="text-teal-600 font-bold uppercase tracking-widest text-sm">Analysis Results for</h4>
        <h1 class="text-4xl lg:text-5xl font-extrabold tracking-tight text-slate-900">{{ results.medicine }}</h1>
      </div>
      <div class="flex gap-4">
        <button onclick="window.print()"
          class="p-4 bg-slate-50 hover:bg-slate-100 text-slate-600 rounded-2xl border border-slate-200 transition-all">
          <i data-lucide="printer" class="w-6 h-6"></i>
        </button>
        <div class="bg-teal-50 px-6 py-4 rounded-2xl border border-teal-100">
          <p class="text-xs font-bold text-teal-600 uppercase tracking-widest mb-1">Status</p>
          <p class="text-teal-900 font-extrabold flex items-center gap-2">
            <span class="relative flex h-2 w-2">
              <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-teal-400 opacity-75"></span>
              <span class="relative inline-flex rounded-full h-2 w-2 bg-teal-500"></span>
            </span>
            Verified Report
          </p>
        </div>
      </div>
    </div>

    <!-- Charts Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      <!-- Sentiment Chart -->
      <div class="bg-white p-8 rounded-[2.5rem] shadow-lg border border-slate-100 flex flex-col">
        <div class="flex items-center gap-3 mb-6">
          <div class="bg-blue-100 p-2 rounded-lg">
            <i data-lucide="pie-chart" class="text-blue-600 w-5 h-5"></i>
          </div>
          <h3 class="text-xl font-bold text-slate-900">Patient Sentiment Analysis</h3>
        </div>
        <div id="chartdiv" class="chart-container"></div>
        <p class="text-xs text-slate-500 mt-4 italic">Aggregated from public patient reviews and healthcare forums.</p>
      </div>

      <!-- Health Safety Profile (Pictorial) -->
      <div class="bg-white p-8 rounded-[2.5rem] shadow-lg border border-slate-100 flex flex-col">
        <div class="flex items-center gap-3 mb-6">
          <div class="bg-emerald-100 p-2 rounded-lg">
            <i data-lucide="shield-check" class="text-emerald-600 w-5 h-5"></i>
          </div>
          <h3 class="text-xl font-bold text-slate-900">Safety & Efficacy Profile</h3>
        </div>
        <div id="chartdiv2" class="chart-container"></div>
        <p class="text-xs text-slate-500 mt-4 italic">Visualizing the balance between positive outcomes and reported
          harm.</p>
      </div>
    </div>

    <!-- Details Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
      <!-- Review Summary Card -->
      <div class="lg:col-span-7 bg-white p-8 rounded-[2.5rem] shadow-lg border border-slate-100 flex flex-col">
        <div class="flex justify-between items-center mb-6">
          <div class="flex items-center gap-3">
            <div class="bg-indigo-100 p-2 rounded-lg">
              <i data-lucide="sparkles" class="text-indigo-600 w-5 h-5"></i>
            </div>
            <h3 class="text-xl font-bold text-slate-900">AI Review Summary</h3>
          </div>
          <div class="flex gap-2">
            <button onclick="speakContent('review-content')"
              class="p-2.5 bg-indigo-50 text-indigo-600 hover:bg-indigo-100 rounded-xl transition-all">
              <i data-lucide="volume-2" class="w-5 h-5"></i>
            </button>
            <button onclick="stopSpeech()"
              class="p-2.5 bg-slate-50 text-slate-400 hover:text-red-500 rounded-xl transition-all">
              <i data-lucide="circle-stop" class="w-5 h-5"></i>
            </button>
          </div>
        </div>

        <div id="review-content"
          class="bg-indigo-50/50 p-6 rounded-2xl border border-indigo-100 text-slate-700 font-medium leading-relaxed italic text-lg flex-grow">
          {% for point in results.review_summary %}
          {{ ''.join(point) }}
          {% endfor %}
        </div>
      </div>

      <!-- Side Effects Card -->
      <div
        class="lg:col-span-5 bg-slate-900 text-white p-8 rounded-[2.5rem] shadow-2xl relative overflow-hidden flex flex-col">
        <div class="absolute top-0 right-0 w-64 h-64 bg-teal-500/10 rounded-full blur-3xl -mr-32 -mt-32"></div>
        <div class="flex justify-between items-center mb-6 relative z-10">
          <div class="flex items-center gap-3">
            <div class="bg-slate-800 p-2 rounded-lg">
              <i data-lucide="zap" class="text-amber-400 w-5 h-5"></i>
            </div>
            <h3 class="text-xl font-bold">Reported Side Effects</h3>
          </div>
          <button onclick="speakContent('side-effects-content')"
            class="p-2.5 bg-slate-800 hover:bg-slate-700 text-teal-400 rounded-xl transition-all">
            <i data-lucide="volume-2" class="w-5 h-5"></i>
          </button>
        </div>

        <div id="side-effects-content" class="space-y-3 overflow-y-auto pr-2 max-h-[300px] flex-grow relative z-10">
          {% for point in results.side_effects %}
          <div
            class="p-4 bg-slate-800/50 border border-slate-700 rounded-2xl flex gap-3 items-start group hover:border-teal-500/50 transition-all">
            <div class="mt-1 w-1.5 h-1.5 rounded-full bg-amber-400 flex-shrink-0 group-hover:bg-teal-400"></div>
            <p class="text-slate-300 font-medium text-sm leading-relaxed">{{ ''.join(point) }}</p>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </main>

  <script>
    lucide.createIcons();

    // 3D Pie Chart (AmCharts 4)
    am4core.ready(function () {
      am4core.useTheme(am4themes_animated);
      var chart = am4core.create("chartdiv", am4charts.PieChart3D);
      chart.hiddenState.properties.opacity = 0;

      chart.data = [
        { category: "Positive", value: {{ results.sentiment[0] }}, color: am4core.color("#0d9488") },
      { category: "Neutral", value: {{ results.sentiment[2] }}, color: am4core.color("#94a3b8") },
      { category: "Negative", value: {{ results.sentiment[1] }}, color: am4core.color("#f43f5e") }
            ];

    var series = chart.series.push(new am4charts.PieSeries3D());
    series.dataFields.value = "value";
    series.dataFields.category = "category";
    series.slices.template.propertyFields.fill = "color";
    series.labels.template.disabled = true;
    series.ticks.template.disabled = true;

    chart.legend = new am4charts.Legend();
    chart.legend.position = "bottom";
    chart.legend.labels.template.fontWeight = "bold";
        });

    // Pictorial Stacked (AmCharts 5)
    am5.ready(function () {
      var root = am5.Root.new("chartdiv2");
      root.setThemes([am5themes_Animated.new(root)]);

      var chart = root.container.children.push(am5percent.SlicedChart.new(root, {
        layout: root.verticalLayout
      }));

      var series = chart.series.push(am5percent.PictorialStackedSeries.new(root, {
        orientation: "vertical",
        valueField: "value",
        categoryField: "category",
        svgPath: "M53.5,476c0,14,6.833,21,20.5,21s20.5-7,20.5-21V287h21v189c0,14,6.834,21,20.5,21 c13.667,0,20.5-7,20.5-21V154h10v116c0,7.334,2.5,12.667,7.5,16s10.167,3.333,15.5,0s8-8.667,8-16V145c0-13.334-4.5-23.667-13.5-31 s-21.5-11-37.5-11h-82c-15.333,0-27.833,3.333-37.5,10s-14.5,17-14.5,31v133c0,6,2.667,10.333,8,13s10.5,2.667,15.5,0s7.5-7,7.5-13 V154h10V476 M61.5,42.5c0,11.667,4.167,21.667,12.5,30S92.333,85,104,85s21.667-4.167,30-12.5S146.5,54,146.5,42 c0-11.335-4.167-21.168-12.5-29.5C125.667,4.167,115.667,0,104,0S82.333,4.167,74,12.5S61.5,30.833,61.5,42.5z"
      }));

      series.get("colors").set("colors", [
        am5.color("#10b981"), // Good
        am5.color("#fbbf24"), // Neutral
        am5.color("#ef4444")  // Harm
      ]);

      series.data.setAll([
        { value: {{ results.sentiment[0] }}, category: "BENEFIT" },
      { value: {{ results.sentiment[2] }}, category: "NEUTRAL" },
      { value: {{ results.sentiment[1] }}, category: "RISK" }
            ]);

    series.labels.template.set("text", "{category}");
    series.appear(1000, 100);
        });

    // Speech
    function speakContent(elementId) {
      const content = document.getElementById(elementId).innerText.replace(/[\n\r\t_*/]+/g, ' ');
      const speech = new SpeechSynthesisUtterance(content);
      speech.volume = 1;
      speech.rate = 0.9;
      speech.pitch = 1;
      window.speechSynthesis.speak(speech);
    }

    function stopSpeech() {
      window.speechSynthesis.cancel();
    }
  </script>
</body>

</html>